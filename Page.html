<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body {
        background-color: #ffffff;
        color: #303030;
        font-family: Arial, sans-serif;
        padding: 10px;
      }

      .container {
        padding: 16px;
      }

      .label {
        display: block;
        font-weight: bold;
        margin-top: 10px;
      }

      .input {
        width: calc(100% - 22px);
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
        border: 1px solid #ddd;
      }

      .color-picker {
        display: flex;
        justify-content: space-around;
        margin: 12px 0;
        gap: 8px;
      }

      .color-button {
        width: 34px;
        height: 34px;
        border-radius: 50%;
        border: 2px solid #ddd;
        cursor: pointer;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        transition: border-color 0.2s, box-shadow 0.2s;
      }

      .color-button.selected {
        border: 3px solid #000;
        box-shadow: 0 0 0 2px #fff, 0 0 0 4px #000;
      }

      .manual-color {
        width: calc(100% - 22px);
        height: 34px;
        border-radius: 4px;
        border: 1px solid #ddd;
        margin: 10px 0;
      }

      .action-button {
        background-color: #cf2e2e;
        color: #ffffff;
        border: none;
        border-radius: 4px;
        padding: 10px 16px;
        cursor: pointer;
        margin-top: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        transition: background-color 0.3s;
      }

      .action-button:hover {
        background-color: #b12828;
      }

      .loader {
        border: 4px solid #f3f3f3;
        border-radius: 50%;
        border-top: 4px solid #cf2e2e;
        width: 20px;
        height: 20px;
        -webkit-animation: spin 2s linear infinite;
        animation: spin 2s linear infinite;
        display: none;
      }

      @-webkit-keyframes spin {
        0% { -webkit-transform: rotate(0deg); }
        100% { -webkit-transform: rotate(360deg); }
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      .status-message {
        display: none;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <label class="label" for="value">Valores a buscar (separados por espacios):</label>
      <input type="text" id="value" class="input" name="value">
      <label class="label">Color:</label>
      <div class="color-picker">
        <button class="color-button" data-color="#ff0000" style="background-color: #ff0000;" onclick="selectColor('#ff0000')"></button>
        <button class="color-button" data-color="#ffff00" style="background-color: #ffff00;" onclick="selectColor('#ffff00')"></button>
        <button class="color-button" data-color="#0000ff" style="background-color: #0000ff;" onclick="selectColor('#0000ff')"></button>
        <button class="color-button" data-color="#00ff00" style="background-color: #00ff00;" onclick="selectColor('#00ff00')"></button>
        <button class="color-button" data-color="#ff9900" style="background-color: #ff9900;" onclick="selectColor('#ff9900')"></button>
      </div>
      <input type="color" id="manualColor" class="manual-color" onchange="selectManualColor()">
      <input type="hidden" id="color" name="color">
      <button class="action-button" onclick="findAndColor()">Buscar y Colorear Texto</button>
      <button class="action-button" onclick="findAndColorRows()">Buscar y Colorear Filas</button>
      <div class="loader" id="loader"></div>
      <div class="status-message" id="statusMessage"></div>
    </div>

    <script>
      function selectColor(color) {
        document.getElementById('color').value = color;
        highlightSelectedColor(color);
      }

      function selectManualColor() {
        var color = document.getElementById('manualColor').value;
        document.getElementById('color').value = color;
        highlightSelectedColor(color);
      }

      function highlightSelectedColor(color) {
        var buttons = document.querySelectorAll('.color-button');
        var normalized = color.toLowerCase();

        buttons.forEach(function(button) {
          if (button.dataset.color && button.dataset.color.toLowerCase() === normalized) {
            button.classList.add('selected');
          } else {
            button.classList.remove('selected');
          }
        });
      }

      function findAndColor() {
        var value = document.getElementById('value').value;
        var color = document.getElementById('color').value;
        if (color === "") {
          alert("Por favor, seleccione un color.");
          return;
        }
        document.getElementById('loader').style.display = 'inline-block';
        google.script.run.withSuccessHandler(onSuccess).findAndHighlight(value, color);
      }

      function findAndColorRows() {
        var value = document.getElementById('value').value;
        var color = document.getElementById('color').value;
        if (color === "") {
          alert("Por favor, seleccione un color.");
          return;
        }
        document.getElementById('loader').style.display = 'inline-block';
        google.script.run.withSuccessHandler(onSuccess).findAndHighlightRows(value, color);
      }

      function onSuccess(message) {
        document.getElementById('loader').style.display = 'none';
        var statusMessage = document.getElementById('statusMessage');
        statusMessage.innerText = message;
        statusMessage.style.display = 'block';
      }
    </script>
  </body>
</html>
